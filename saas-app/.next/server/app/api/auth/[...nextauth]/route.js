"use strict";(()=>{var e={};e.id=912,e.ids=[912],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},10528:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>c,staticGenerationAsyncStorage:()=>u});var r={};a.r(r),a.d(r,{GET:()=>s,POST:()=>l});var i=a(49303),n=a(88716),o=a(60670);let{GET:s,POST:l}=a(90455).handlers,p=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/[...nextauth]/route",pathname:"/api/auth/[...nextauth]",filename:"route",bundlePath:"app/api/auth/[...nextauth]/route"},resolvedPagePath:"/Users/quentincasares/.openclaw/workspace/saas-app/app/api/auth/[...nextauth]/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:u,serverHooks:c}=p,m="/api/auth/[...nextauth]/route";function g(){return(0,o.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:u})}},90455:(e,t,a)=>{a.d(t,{I8:()=>p,handlers:()=>l});var r=a(41202),i=a(8204),n=a(80772);async function o(e,t,a){try{let r=await fetch("https://api.resend.com/emails",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({from:process.env.EMAIL_FROM||"noreply@socialflow.app",to:e,subject:"Your SocialFlow Login Code",html:`
          <div style="font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
            <div style="text-align: center; margin-bottom: 30px;">
              <h1 style="background: linear-gradient(135deg, #ff00ff, #00ffff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 32px; margin: 0;">
                âœ¨ SocialFlow
              </h1>
            </div>
            <h2 style="color: #333; margin-bottom: 10px;">Your Login Code</h2>
            <p style="color: #666; margin-bottom: 20px;">Use the following code to log in:</p>
            <div style="background: linear-gradient(135deg, #f3f4f6, #e5e7eb); padding: 30px; border-radius: 12px; text-align: center; margin-bottom: 20px;">
              <span style="font-size: 40px; letter-spacing: 12px; font-weight: bold; background: linear-gradient(135deg, #ff00ff, #00ffff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                ${t}
              </span>
            </div>
            <p style="color: #999; font-size: 14px; margin-top: 20px;">This code expires in 10 minutes.</p>
            <p style="color: #999; font-size: 14px;">If you didn't request this, please ignore this email.</p>
          </div>
        `})});if(!r.ok)throw console.error("Failed to send email:",await r.text()),Error("Failed to send email");return!0}catch(e){throw console.error("Error sending OTP email:",e),e}}let s={providers:[(0,i.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,allowDangerousEmailAccountLinking:!0}),(0,n.Z)({id:"otp",name:"OTP",credentials:{email:{label:"Email",type:"email"},code:{label:"Code",type:"text"},action:{label:"Action",type:"text"},name:{label:"Name",type:"text"}},async authorize(e){if(!e?.email)return null;let{email:t,code:a,action:r,name:i}=e,n=process.env.DB;if(!n)return console.error("D1 database not configured"),null;if("request"===r){let e=Math.floor(1e5+9e5*Math.random()).toString(),a=new Date(Date.now()+6e5).toISOString();return await n.prepare("UPDATE otp_codes SET used = 1 WHERE email = ? AND used = 0").bind(t).run(),await n.prepare("INSERT INTO otp_codes (id, email, code, expires_at) VALUES (?, ?, ?, ?)").bind(crypto.randomUUID(),t,e,a).run(),process.env.RESEND_API_KEY?await o(t,e,process.env.RESEND_API_KEY):console.log(`OTP for ${t}: ${e}`),{id:"temp",email:t,otpRequested:!0}}if(a){let e=await n.prepare("SELECT * FROM otp_codes WHERE email = ? AND code = ? AND used = 0 AND expires_at > datetime('now')").bind(t,a).first();if(!e)return null;await n.prepare("UPDATE otp_codes SET used = 1 WHERE id = ?").bind(e.id).run();let r=await n.prepare("SELECT * FROM users WHERE email = ?").bind(t).first();if(!r){let e=crypto.randomUUID(),a=new Date().toISOString();await n.prepare("INSERT INTO users (id, email, name, created_at, updated_at) VALUES (?, ?, ?, ?, ?)").bind(e,t,i||null,a,a).run(),await n.prepare("INSERT INTO subscriptions (id, user_id, plan, status, created_at) VALUES (?, ?, 'free', 'active', ?)").bind(crypto.randomUUID(),e,a).run(),r={id:e,email:t,name:i||null,image:null}}return{id:r.id,email:r.email,name:r.name,image:r.image}}return null}})],session:{strategy:"jwt",maxAge:2592e3},callbacks:{jwt:async({token:e,user:t,account:a})=>(t&&(e.id=t.id,e.email=t.email,e.name=t.name,e.image=t.image),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.email=t.email,e.user.name=t.name||null,e.user.image=t.image||null),e)},pages:{signIn:"/login",signOut:"/",error:"/login"},events:{async signIn({user:e,account:t,isNewUser:a}){console.log("User signed in:",e.email)}}},{handlers:l,auth:p,signIn:d,signOut:u}=(0,r.ZP)(s)},49303:(e,t,a)=>{e.exports=a(30517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,70,280],()=>a(10528));module.exports=r})();