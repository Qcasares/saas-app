"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},56140:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var a={};r.r(a),r.d(a,{PUT:()=>p});var n=r(49303),i=r(88716),o=r(60670),s=r(90455),l=r(87070);async function p(e){try{let t=await (0,s.I8)();if(!t?.user?.id)return l.NextResponse.json({error:"Unauthorized"},{status:401});let{name:r}=await e.json();if(!r||"string"!=typeof r)return l.NextResponse.json({error:"Invalid name"},{status:400});let a=process.env.DB;if(!a)return l.NextResponse.json({error:"Database not configured"},{status:500});return await a.prepare("UPDATE users SET name = ?, updated_at = datetime('now') WHERE id = ?").bind(r,t.user.id).run(),l.NextResponse.json({success:!0})}catch(e){return console.error("Error updating profile:",e),l.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/user/profile/route",pathname:"/api/user/profile",filename:"route",bundlePath:"app/api/user/profile/route"},resolvedPagePath:"/Users/quentincasares/.openclaw/workspace/saas-app/app/api/user/profile/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:u,staticGenerationAsyncStorage:c,serverHooks:m}=d,g="/api/user/profile/route";function f(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},90455:(e,t,r)=>{r.d(t,{I8:()=>p,handlers:()=>l});var a=r(41202),n=r(8204),i=r(80772);async function o(e,t,r){try{let a=await fetch("https://api.resend.com/emails",{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({from:process.env.EMAIL_FROM||"noreply@socialflow.app",to:e,subject:"Your SocialFlow Login Code",html:`
          <div style="font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
            <div style="text-align: center; margin-bottom: 30px;">
              <h1 style="background: linear-gradient(135deg, #ff00ff, #00ffff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 32px; margin: 0;">
                âœ¨ SocialFlow
              </h1>
            </div>
            <h2 style="color: #333; margin-bottom: 10px;">Your Login Code</h2>
            <p style="color: #666; margin-bottom: 20px;">Use the following code to log in:</p>
            <div style="background: linear-gradient(135deg, #f3f4f6, #e5e7eb); padding: 30px; border-radius: 12px; text-align: center; margin-bottom: 20px;">
              <span style="font-size: 40px; letter-spacing: 12px; font-weight: bold; background: linear-gradient(135deg, #ff00ff, #00ffff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                ${t}
              </span>
            </div>
            <p style="color: #999; font-size: 14px; margin-top: 20px;">This code expires in 10 minutes.</p>
            <p style="color: #999; font-size: 14px;">If you didn't request this, please ignore this email.</p>
          </div>
        `})});if(!a.ok)throw console.error("Failed to send email:",await a.text()),Error("Failed to send email");return!0}catch(e){throw console.error("Error sending OTP email:",e),e}}let s={providers:[(0,n.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,allowDangerousEmailAccountLinking:!0}),(0,i.Z)({id:"otp",name:"OTP",credentials:{email:{label:"Email",type:"email"},code:{label:"Code",type:"text"},action:{label:"Action",type:"text"},name:{label:"Name",type:"text"}},async authorize(e){if(!e?.email)return null;let{email:t,code:r,action:a,name:n}=e,i=process.env.DB;if(!i)return console.error("D1 database not configured"),null;if("request"===a){let e=Math.floor(1e5+9e5*Math.random()).toString(),r=new Date(Date.now()+6e5).toISOString();return await i.prepare("UPDATE otp_codes SET used = 1 WHERE email = ? AND used = 0").bind(t).run(),await i.prepare("INSERT INTO otp_codes (id, email, code, expires_at) VALUES (?, ?, ?, ?)").bind(crypto.randomUUID(),t,e,r).run(),process.env.RESEND_API_KEY?await o(t,e,process.env.RESEND_API_KEY):console.log(`OTP for ${t}: ${e}`),{id:"temp",email:t,otpRequested:!0}}if(r){let e=await i.prepare("SELECT * FROM otp_codes WHERE email = ? AND code = ? AND used = 0 AND expires_at > datetime('now')").bind(t,r).first();if(!e)return null;await i.prepare("UPDATE otp_codes SET used = 1 WHERE id = ?").bind(e.id).run();let a=await i.prepare("SELECT * FROM users WHERE email = ?").bind(t).first();if(!a){let e=crypto.randomUUID(),r=new Date().toISOString();await i.prepare("INSERT INTO users (id, email, name, created_at, updated_at) VALUES (?, ?, ?, ?, ?)").bind(e,t,n||null,r,r).run(),await i.prepare("INSERT INTO subscriptions (id, user_id, plan, status, created_at) VALUES (?, ?, 'free', 'active', ?)").bind(crypto.randomUUID(),e,r).run(),a={id:e,email:t,name:n||null,image:null}}return{id:a.id,email:a.email,name:a.name,image:a.image}}return null}})],session:{strategy:"jwt",maxAge:2592e3},callbacks:{jwt:async({token:e,user:t,account:r})=>(t&&(e.id=t.id,e.email=t.email,e.name=t.name,e.image=t.image),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.email=t.email,e.user.name=t.name||null,e.user.image=t.image||null),e)},pages:{signIn:"/login",signOut:"/",error:"/login"},events:{async signIn({user:e,account:t,isNewUser:r}){console.log("User signed in:",e.email)}}},{handlers:l,auth:p,signIn:d,signOut:u}=(0,a.ZP)(s)},49303:(e,t,r)=>{e.exports=r(30517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,70,280],()=>r(56140));module.exports=a})();